<!-- contacts.wxml -->
<view class="container">
  <!-- 新增联系人按钮 -->
  <view class="add-contact-button-container">
    <button class="add-contact-button" bindtap="showAddContactModal">
      <text class="add-icon">+</text>
      <text>新增联系人</text>
    </button>
  </view>
  
  <!-- 内容区域 -->
  <view class="content-area">
    <view wx:if="{{contacts.length === 0}}" class="no-contacts">
      <text class="no-contacts-text">暂无联系人</text>
      <text class="no-contacts-hint">请联系子女远程绑定</text>
    </view>
    <view wx:else class="contacts-list">
      <view wx:for="{{contacts}}" wx:key="contactsId" class="contact-item {{item.isDefault === '1' ? 'emergency-contact' : ''}}">
        <view class="contact-info">
          <view class="contact-header">
            <text class="contact-name">{{item.name}} <text class="emergency-icon" wx:if="{{item.isDefault === '1'}}">⚠️</text></text>
            <text class="contact-emergency" wx:if="{{item.isDefault === '1'}}">紧急联系人</text>
          </view>
          <text class="contact-note" wx:if="{{item.remark}}">{{item.remark}}</text>
          <text class="contact-phone">{{item.phone}}</text>
        </view>
        <view class="contact-actions">
          <button class="contact-btn edit-btn" bindtap="showEditContactModal" data-contact="{{item}}">编辑</button>
          <button class="contact-btn delete-btn" bindtap="deleteContact" data-contact="{{item}}">删除</button>
          <button class="contact-btn emergency-btn" bindtap="toggleEmergency" data-contact="{{item}}">
            {{item.isDefault === '1' ? '取消紧急' : '设为紧急'}}
          </button>
        </view>
      </view>
    </view>
    
    <!-- 加载更多提示 -->
    <view wx:if="{{loading}}" class="loading-more">
      <text class="loading-text">加载中...</text>
    </view>
    
    <!-- 没有更多数据提示 -->
    <view wx:elif="{{!hasMore && contacts.length > 0}}" class="no-more">
      <text class="no-more-text">没有更多联系人了</text>
    </view>
  </view>
  
  
  
  <!-- 新增/编辑联系人弹窗 -->
  <view class="modal-overlay" wx:if="{{showContactModal}}" bindtap="hideContactModal"></view>
  <view class="modal-container add-contact-modal" wx:if="{{showContactModal}}">
    <view class="modal-header">
      <text class="modal-title">{{isEditMode ? '编辑联系人' : '添加联系人'}}</text>
      <view class="modal-close" bindtap="hideContactModal">×</view>
    </view>
    <view class="modal-content">
      <view class="form-group">
        <label class="form-label">姓名</label>
        <input class="form-input" placeholder="请输入联系人姓名" value="{{newContact.name}}" bindinput="handleInputChange" data-field="name" />
      </view>
      <view class="form-group">
        <label class="form-label">电话号码</label>
        <input class="form-input" placeholder="请输入电话号码" value="{{newContact.phone}}" bindinput="handleInputChange" data-field="phone" type="number" />
      </view>
      <view class="form-group">
        <label class="form-label">备注</label>
        <input class="form-input" placeholder="请输入备注信息" value="{{newContact.remark}}" bindinput="handleInputChange" data-field="remark" />
      </view>
      <view class="form-group">
          <label class="form-label">类型</label>
          <radio-group class="radio-group" bindchange="handleRadioChange">
            <label class="radio-item">
              <radio value="0" checked="{{newContact.isDefault === '0'}}"/> 普通联系人
            </label>
            <label class="radio-item">
              <radio value="1" checked="{{newContact.isDefault === '1'}}"/> 紧急联系人
            </label>
          </radio-group>
        </view>
    </view>
    <view class="modal-footer">
      <button class="modal-button" bindtap="saveContact">{{isEditMode ? '更新' : '保存'}}</button>
      <button class="modal-button cancel-btn" bindtap="hideContactModal">取消</button>
    </view>
  </view>
</view>